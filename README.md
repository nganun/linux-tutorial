# Linux 应该这么学

## 5. 用户身份与用户权限

### 5.1 用户身份与能力

> UID: User IDentification

- 管理员 UID 为 0： 系统管理员用户
- 系统用户 UID 为 1~999：默认服务程序会由独立的系统用户负责运行
- 普通用户 UID 从 1000 开始：是由管理员创建的用于日常工作的用户

> GID: Group IDentification

在 Linux 系统中创建每个用户时，将自动创建一个与其同名的基本用户组，而且这个基本用户组只有该用户一个人。
如果该用户以后被归纳到其他用户组，则这个其他用户组称之为扩展用户组。
一个用户只有一个基本用户组，但是可以有多个扩展用户组。

#### 5.1.1 id 命令

- 用法：id 用户名
- 功能：查看用户的基本信息，例如用户 ID、基本组、扩展组 GID
- 示例
```sh
id qk
```

#### 5.1.2 useradd 命令

- 用法：useradd [参数] 用户名
- 功能：创建用户。默认的用户家目录会被存放在 /home 目录中，默认的 Shell 解释器为 /bin/bash，而且默认会创建一个与该用户组同名的基本用户组。
- 参数
  - -d: 指定用户家目录
  - -u: 指定该用户默认的 UID
  - -g: 指定一个初始有用户基本组
  - -G: 指定一个或多个扩展组
  - -s: 指定该用户的默认 Shell 解释器
- 示例
```sh
useradd qk
id qk
# 如果用户的解释器被调协为 nologin，代表该用户不能登录到系统
useradd -d /home/linux -u 8888 -s /sbin/nologin qk
```

#### 5.1.3 groupadd 命令

- 用法：groupadd [参数] 群组名
- 功能：用于创建新的用户组
- 示例：
```sh
groupadd team
```

#### 5.1.4 usermod 命令

- 用法：usermod [参数] 用户名
- 功能：user modify，用于修改用户的属性，如用户的 UID、基本/扩展组、默认终端等。用户的信息保存在 `/etc/passwd` 文件中。可以直接修改此配置文件，也可以直接用此命令修改。
- 参数
  - -c: 填写用户的备注信息
  - -d -m: 重新指定用户的家目录并自动把旧的数据转移过去
  - -u: 修改用户的 UID
  - -g: 变更所属用户组
  - -G: 变更扩展用户组
  - -L: 锁定用户禁止基登录系统
  - -U: 解锁用户，允许其登录系统
  - -s: 变更默认终端
- 示例
```sh
id qk
# 将用户 qk 添加到 root 用户组
usermod -G root qk
usermod -u 8888 qk
usermod -s /sbin/nologin qk
su - qk
# This account is currently not available
```

#### 5.1.5 passwd 命令

- 用法：passwd [参数] 用户名
- 功能：用于修改用户的密码过期时间等信息。普通用户只能使用 passwd 命令修改自己系统的密码，root 可以修改其他所有人的密码，且 root 在修改自己或他人的密码时不需要验证旧密码。
- 参数：
  - --stdin: 通过标准输入修改用户的密码
  - -d: 使该用户可以使用空密码登录系统
  - -e: 强制用户在下次登录时修改密码
  - -S: 显示用户的密码是否被锁定，以及密码所采用的加密算法等
- 示例
```sh
# 通过标准输入修改用户密码
echo "NewPassWold" | passwd --stdin qk
# root 修改自己的密码 # 输入密码值 # 再次输入密码值
passwd
# root 修改其他人的密码 # 输入密码值 # 再次输入密码值
passwd qk
# 锁定用户
passwd -l qk
passwd -S qk
passwd -u qk
passwd -S qk
```

#### 5.1.6 userdel 命令
 
- 用法：userdel [参数] 用户名
- 功能：删除用户，默认家目录会保留下
- 参数：
  - -f: 强制删除用户
  - -r: 同时删除用户及家目录
- 示例：
```sh
userdel qk
id qk
cd /home
rm -rf qk
```

### 5.2 文件权限与归属

对于目录文件
- 可读：表示可以读取目录内的文件列表
- 可写：表示能够在目录内新增、删除、重命名文件
- 可执行：表示能够进入该目录

文件类型：
- -: 普通文件
- d: 目录文件
- l: 链接文件
- p: 管道文件
- b: 块设备文件
- c: 字符设备文件

```sh
ls -l Install.log
-rw-r--r-- 1 root root 34298 04-02 00:23 Install.log
# 普通文件，所属人可读写，所属组可读，其它可读，所有者，所属组，文件字节，最后修改时间，文件名
```

### 5.3 文件的特殊权限

#### 5.3.1 SUID

SUID 是一种对二进制程序进行设置的特殊权限，能够让二进制程序的执行者临时拥有所有者的权限（仅对拥有执行权限的二进制程序有效）
用户的密码保存在 /etc/shadow 文件内
一旦某个命令被设置了 SUID 权限，就意味着凡是执行该文件的人都可以临时获取到文件所有者所对应的更高权限。因此不要把 SUID 权限设置到 vim, cat, rm 等命令上

```sh
ls -l /etc/shadow # ----------
ls -l /bin/passwd # -rwsr-xr-x
```

#### 5.3.2 SGID



